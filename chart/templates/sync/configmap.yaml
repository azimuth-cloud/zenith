{{- define "zenith.sync.defaults" -}}
{{- $ingress := merge .Values.common.ingress .Values.global.ingress }}
consul:
  address: {{ tpl .Values.common.consul.address . | quote }}
  port: {{ .Values.common.consul.port }}
  serviceTag: {{ .Values.common.consul.serviceTag | quote }}
  tlsKeyPrefix: {{ .Values.common.consul.serviceKeyPrefix | quote }}
kubernetes:
  ingress:
    baseDomain: {{ $ingress.baseDomain | quote }}
    className: {{ $ingress.className | quote }}
    annotations: {{ $ingress.annotations | toYaml | nindent 6 }}
    tls:
      enabled: {{ $ingress.tls.enabled }}
      {{- with $ingress.tls.secretName }}
      secretName: {{ . | quote }}
      {{- end }}
{{- end }}

{{- if .Values.sync.enabled -}}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "zenith.componentname" (list . "sync-conf") }}
  labels: {{ include "zenith.componentLabels" (list . "sync-conf") | nindent 4 }}
data:
  sync.yaml: |
    {{-
      include "zenith.sync.defaults" . |
        fromYaml |
        merge .Values.sync.config |
        toYaml |
        nindent 4
    }}
{{- end }}
