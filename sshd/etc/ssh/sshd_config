#####
## SSHD config for the tunnel server
##
## It is designed to shut out SSH access for all users except the tunnel user
## and restrict the tunnel user to a particular sandbox
#####

# Use a subdirectory of /var/run for the pidfile
# We will mount a writable directory there
PidFile /var/run/sshd/sshd.pid

# Allow the tunnel user only
AllowUsers tunnel

# The tunnel user can authenticate with an empty password
PasswordAuthentication yes
PermitEmptyPasswords yes

# Force the tunnel-init command to run
ForceCommand tunnel-init

# Allow the user to create reverse SSH tunnels only
AllowTcpForwarding remote

# Force reverse tunnels to bind to the wildcard address so they can be accessed
#Â from outside the container
GatewayPorts yes

# We want to detect and detach dead clients quickly
# This will ensure dead clients are detached within 30s
ClientAliveCountMax 3
ClientAliveInterval 10

# All other authentication methods are disabled
ChallengeResponseAuthentication no
GSSAPIAuthentication no
HostbasedAuthentication no
KerberosAuthentication no
PermitRootLogin no
PubkeyAuthentication no
UsePAM no

# Restrict the available features to only those that are required for tunnels
AllowAgentForwarding no
AllowStreamLocalForwarding no
PermitTunnel no
PermitUserEnvironment no
X11Forwarding no
